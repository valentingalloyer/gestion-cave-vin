<div class="form-container" [class]="currentCouleur" [class.highlight-active]="isHighlighted()">
  <h3>Ajouter une nouvelle bouteille</h3>
  <form [formGroup]="vinForm" (ngSubmit)="onSubmit()">
    <div class="form-grid">

      <div class="form-group full-width">
        <label>Couleur de la robe</label>
        <div class="color-selector">
          <label class="radio-btn rouge">
            <input type="radio" formControlName="couleur" value="Rouge"> <span>Rouge</span>
          </label>
          <label class="radio-btn blanc">
            <input type="radio" formControlName="couleur" value="Blanc"> <span>Blanc</span>
          </label>
          <label class="radio-btn rose">
            <input type="radio" formControlName="couleur" value="Rosé"> <span>Rosé</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="nom">Nom du vin</label>
        <input id="nom" formControlName="nom" placeholder="ex: Château Margaux">
      </div>

      <div class="form-group">
        <label for="domaine">Domaine</label>
        <input id="domaine" formControlName="domaine" placeholder="ex: Domaine de la Romanée-Conti">
      </div>

      <div class="form-group">
        <label>Région / Appellation</label>
        <select formControlName="appellation">
          <option value="">-- Choisir une région --</option>
          @for (groupe of REGIONS_GROUPEES; track groupe.label) {
            <optgroup [label]="groupe.label">
              @for (r of groupe.regions; track r) {
                <option [value]="r">{{ r }}</option>
              }
            </optgroup>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="millesime">Année (Millésime)</label>
        <input id="millesime" type="number" formControlName="millesime"
               [class.invalid]="vinForm.get('millesime')?.invalid && vinForm.get('millesime')?.touched">
        @if (vinForm.get('millesime')?.invalid && vinForm.get('millesime')?.touched) {
          <div class="error-msg">
            @if (vinForm.get('millesime')?.errors?.['max']) {
              Le vin du futur n'existe pas encore !
            }
            @if (vinForm.get('millesime')?.errors?.['min']) {
              1900 minimum !
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="quantite">Quantité</label>
        <input id="quantite" type="number" formControlName="quantite">
      </div>

      <div class="form-group">
        <label for="emplacement">Emplacement dans la cave</label>
        <input id="emplacement" formControlName="emplacement" placeholder="ex: Casier A1">
      </div>

    </div>

    <div class="expert-section">
      <h3><span class="icon">✍️</span> Avis du Sommelier</h3>

      <div class="form-row">
        <div class="form-group">
          <label>Note de dégustation</label>
          <div class="star-rating">
            @for (star of [1, 2, 3, 4, 5]; track star) {
              <span
                class="star-input"
                [class.active]="vinForm.get('note')?.value >= star"
                (click)="setNote(star)">
            ★
          </span>
            }
            <span class="note-text">({{ vinForm.get('note')?.value }}/5)</span>
          </div>
        </div>

        <div class="apogee-group">
          <div class="form-group">
            <label>À boire dès</label>
            <input type="number" formControlName="apogeeDebut">
          </div>
          <div class="form-group">
            <label>Jusqu'à</label>
            <input type="number" formControlName="apogeeFin">
          </div>
        </div>
      </div>

      <div class="form-group full-width">
        <label>Commentaires / Accords mets & vins</label>
        <textarea formControlName="notePersonnelle" rows="3"></textarea>
      </div>
    </div>

    <button type="submit" [disabled]="vinForm.invalid">Ajouter à la cave</button>
  </form>
</div>
